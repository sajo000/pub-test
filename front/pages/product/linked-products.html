<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Document</title>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
          integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
          crossorigin="anonymous"></script>

  <!-- BOOTSTRAP CSS -->
  <!--  <link rel="stylesheet" href="../../node_modules/bootstrap/dist/css/bootstrap.min.css">-->
  <!--  <link rel="stylesheet" href="../../node_modules/bootstrap-icons/font/bootstrap-icons.min.css">-->

  <!-- DHTMLX -->
  <link rel="stylesheet" href="../../lib/dhtmlx/suite.min.css">
  <script type="text/javascript" src="../../lib/dhtmlx/suite.min.js"></script>

  <!-- Owl Carousel -->
  <!--  <link rel="stylesheet" href="../../lib/owl-carousel/assets/owl.carousel.min.css">-->
  <!--  <link rel="stylesheet" href="../../lib/owl-carousel/assets/owl.theme.default.min.css">-->
  <!--  <script type="text/javascript" src="../../lib/owl-carousel/owl.carousel.min.js"></script>-->

  <!-- CUSTOM -->
  <script type="text/javascript" src="../../layout.js"></script>
  <script type="text/javascript" src="../../function.js"></script>
  <link rel="stylesheet" href="../../css/app.css">

</head>
<body>
<div id="grid" style="width: 100%; height: 600px;"></div>

<script>
  const dataset = [
    { selected: false, no: "1", productType: "일반상품",  productCode: "202402010164-0004", productName: "마르디메크르디 플라워 맨투맨", amount: "68.5", hsCode: "6211499000", registrant: "msyoon", regDate: "2024-07-12 17:33:50" },
    { selected: false, no: "2", productType: "일반상품",  productCode: "202402010164-0004", productName: "LG 프라엘 더마세라", amount: "1547.2", hsCode: "6211499000", registrant: "msyoon", regDate: "2024-07-12 17:33:50" },
    // ... 이하 동일 구조로 입력
  ];

  // 상세 모달 호출 함수
  function openDetailModal(rowId) {
    const item = grid.getItem(rowId);
    alert("상세페이지: " + (item ? item.productName : rowId));
    // 실제 모달 열기 코드 연결
  }

  // 전체선택 체크박스 클릭 → 모든 row 선택/해제
  function gfn_gridAllCheck(grid) {
    const checkAll = document.getElementById("gridLayerChkAll").checked;
    grid.data.forEach(item => item.selected = checkAll);
    grid.refresh();
  }

  // row 체크박스 클릭 이벤트 위임
  function onRowCheckboxChange(grid, rowId, checked) {
    const item = grid.getItem(rowId);
    if (item) {
      item.selected = checked;
      grid.refreshItem(rowId);
    }
    const allChecked = grid.data.length > 0 && grid.data.every(row => row.selected);
    const selectAll = document.getElementById("gridLayerChkAll");
    if (selectAll) selectAll.checked = allChecked;
  }

  // 그리드 생성
  const grid = new dhx.Grid("grid", {
    columns: [
      {
        width: 40,
        id: "selected",
        header: [{
          htmlEnable: true,
          template: () => `<input type="checkbox" id="gridLayerChkAll" onclick="gfn_gridAllCheck(grid)" />`
        }],
        htmlEnable: true,
        template: value => `<input type="checkbox" class="row-checkbox" ${value ? "checked" : ""} />`
      },
      {
        width: 50,
        id: "detail",
        header: [{ text: "상세" }],
        htmlEnable: true,
        template: (value, row, col, rowIdx) =>
            `<button class="btn-detail" data-rowid="\${row.id || rowIdx}">
            <span class="icon"></span>
          </button>`
      },
      { width: 50, id: "no", header: [{ text: "NO" }] },
      { minWidth: 100, id: "productType", header: [{ text: "상품 타입" }] },
      { minWidth: 150, id: "productCode", header: [{ text: "상품코드" }] },
      { minWidth: 250, id: "productName", header: [{ text: "상품명" }] },
      { width: 80, id: "amount", header: [{ text: "상품가액" }] },
      { width: 120, id: "hsCode", header: [{ text: "HS 코드" }] },
      { minWidth: 100, id: "registrant", header: [{ text: "최초 등록자" }] },
      { minWidth: 180, id: "regDate", header: [{ text: "최초 등록일시" }] }
    ],
    data: dataset,
    autoWidth: true,
    height: 600
  });

  // row 체크박스 클릭 위임
  document.getElementById("grid").addEventListener("click", function(event) {
    if (event.target && event.target.classList.contains("row-checkbox")) {
      const row = event.target.closest("[role=row]");
      if (!row) return;
      const rowId = row.getAttribute("dhx_id");
      onRowCheckboxChange(grid, rowId, event.target.checked);
    }
    // 상세아이콘 클릭
    if (event.target && (event.target.classList.contains("btn-detail") || event.target.closest('.btn-detail'))) {
      const btn = event.target.classList.contains("btn-detail") ? event.target : event.target.closest('.btn-detail');
      const row = btn.closest("[role=row]");
      if (!row) return;
      const rowId = row.getAttribute("dhx_id");
      openDetailModal(rowId);
    }
  });
</script>


</body>
</html>